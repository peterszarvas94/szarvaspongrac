---
import { Trash, X } from "@lucide/astro";
import { Image } from "astro:assets";

export interface Props {
  title: string;
}

const { title } = Astro.props;
// 1. load images from db with data-images="oil"
// 2. clone template for every image
// 3. append images to gallery
// 4. on image click, change popover attributes like src, and show-popover
---

{/* image template */}
<template id="image-gallery-item">
  <div class="break-inside-avoid mb-4 block">
    <div class="relative">
      <button
        commandfor="image-popover"
        command="show-popover"
        class="w-full block cursor-pointer border-0 bg-transparent p-0"
        type="button"
        aria-label="Kép megnyitása"
        title="Kép megnyitása"
      >
        {/* src, alt loads on show-popover */}
        <img
          src=""
          alt=""
          width={200}
          height={250}
          class="w-full block rounded-lg shadow-lg hover:shadow-xl"
          loading="lazy"
        />
        {/* data-delete="image", loads on show-popover*/}
        <button
          data-delete=""
          class="absolute right-4 top-4 border border-base-100 btn btn-error btn-sm btn-square"
        >
          <Trash
            data-auth="true"
            class="size-4"
          />
        </button>
      </button>
    </div>
  </div>
</template>

{/* one popover for all images template */}
<div
  id="image-popover"
  popover
  class="w-screen h-screen bg-base-300/90 backdrop-blur-sm border-0 m-0 p-4 fixed inset-0"
>
  <div class="w-full h-full flex items-center justify-center relative">
    <button
      commandfor="image-popover"
      command="hide-popover"
      class="absolute top-4 right-4 bg-base-content/20 hover:bg-base-content/30 rounded-full p-2 z-10 cursor-pointer"
      aria-label="Kép bezárása (Esc)"
      title="Kép bezárása (Esc)"
      type="button"
    >
      <X class="w-6 h-6 text-base-100" />
    </button>
    {/* src, alt loads on show-popover */}
    <img
      src=""
      alt=""
      width={1200}
      height={900}
      class="max-w-full max-h-full object-contain"
    />
  </div>
</div>

{/* image gallery */}
<div
  id="image-gallery"
  class="columns-1 sm:columns-2 md:columns-3 lg:columns-4 xl:columns-5 gap-4"
>
</div>

<script is:inline>
  // Escape key closes open popover
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      /** @type {HTMLElement | null} */
      const openPopover = document.querySelector("[popover]:popover-open");
      if (openPopover) {
        openPopover.hidePopover();
      }
    }
  });
</script>
